<h1>Look for the lines content</h1>

<%= form_with id: "line-form", method: :get, local: true do |form| %>
  <div>
    <%= form.label :id, "Enter Line index:" %>
    <%= form.number_field :id, required: true, min: 0, id: "line-id-input" %>
  </div>

  <div>
    <%= form.submit "Get Line" %>
  </div>
<% end %>

<div id="line-content">
</div>

<h1>Cached Lines</h1>

<% if @cached_lines.any? %>
  <table>
    <thead>
      <tr>
        <th>Line Index</th>
        <th>Content</th>
      </tr>
    </thead>
    <tbody>
      <% @cached_lines.each do |key, content| %>
        <tr>
          <td><%= key.gsub('line_', '') %></td>
          <td><%= content %></td>
        </tr>
      <% end %>
    </tbody>
  </table>
<% else %>
  <p>No lines cached yet.</p>
<% end %>

<script>
  document.getElementById('line-form').addEventListener('submit', function(event) {
    event.preventDefault();
    const lineId = document.getElementById('line-id-input').value;
    const url = `<%= api_v1_lines_path %>/${lineId}`;

    fetch(url, {
      method: 'GET',
      headers: {
        'Accept': 'application/json',
        'X-Requested-With': 'XMLHttpRequest'
      }
    })
      .then(response => {
        if (!response.ok) {
          throw new Error('Network response was not ok');
        }
        return response.json();
      })
      .then(data => {
        const lineContentDiv = document.getElementById('line-content');
        if (data.error) {
          lineContentDiv.innerHTML = `<h3>Error:</h3><p>${data.error}</p>`;
        } else {
          lineContentDiv.innerHTML = `<h3>Line Content:</h3><p>${data.content}</p>`;
        }
      })
      .catch(error => {
        console.error('Error:', error);
        document.getElementById('line-content').innerHTML = `<h3>Error:</h3><p>Something went wrong. Please try again.</p>`;
      });
  });
</script>
